<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HL7 Forge</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <div class="logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="var(--accent)" stroke="var(--accent)"/>
            </svg>
            HL7 Forge
        </div>
        <div class="stats-bar">
            <div class="stat"><span class="stat-dot green" id="ws-dot"></span><span id="ws-status">Connecting...</span></div>
            <div class="stat"><span class="stat-dot blue"></span>Messages: <span id="stat-total">0</span></div>
            <div class="stat"><span class="stat-dot yellow"></span>Connections: <span id="stat-connections">0</span></div>
            <div class="stat"><span class="stat-dot red"></span>Errors: <span id="stat-errors">0</span></div>
        </div>
        <div class="header-actions">
            <button onclick="togglePause()" id="btn-pause" title="Pause live updates">‚è∏ Pause</button>
            <button onclick="toggleAutoscroll()" id="btn-autoscroll" title="Auto-scroll">‚¨á Auto</button>
            <button onclick="exportMessages()" title="Export JSON">üì• Export</button>
            <button class="danger" onclick="clearMessages()" title="Clear all">üóë Clear</button>
        </div>
    </header>

    <div class="main-container">
        <div class="list-panel">
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Filter: message type, patient, facility, ID..." />
            </div>
            <div class="list-header">
                <span>Type</span>
                <span>Facility</span>
                <span>Patient</span>
                <span>Time</span>
                <span>Segs</span>
            </div>
            <div class="message-list" id="message-list">
                <div class="empty-state" id="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                    <p>Waiting for HL7 messages...</p>
                    <span class="hint">MLLP Server listening on port <span id="mllp-port">2575</span></span>
                </div>
            </div>
        </div>

        <div class="detail-panel">
            <div class="detail-header">
                <h2 id="detail-title">Select a message</h2>
                <span id="detail-meta" style="font-size: 11px; color: var(--text-muted); font-family: var(--font-mono);"></span>
            </div>
            <div class="detail-tabs">
                <button class="detail-tab active" data-tab="parsed" onclick="switchTab('parsed')">Segments</button>
                <button class="detail-tab" data-tab="raw" onclick="switchTab('raw')">Raw</button>
                <button class="detail-tab" data-tab="json" onclick="switchTab('json')">JSON</button>
            </div>
            <div class="detail-content" id="detail-content">
                <div class="empty-state">
                    <p>Click a message to view details</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js" defer></script>
</body>
</html>
